var _=Object.defineProperty,J=Object.defineProperties;var K=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var j=(e,t,o)=>t in e?_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,w=(e,t)=>{for(var o in t||(t={}))Q.call(t,o)&&j(e,o,t[o]);if(D)for(var o of D(t))Z.call(t,o)&&j(e,o,t[o]);return e},q=(e,t)=>J(e,K(t));function E(){let e=!1,t,o,r=(i,d)=>{e||(e=!0,i(d))},n=new Promise((i,d)=>{t=i,o=d});return n.resolve=i=>r(t,i),n.reject=i=>r(o,i),n}function ee(e){return e&&typeof e=="object"&&!Array.isArray(e)&&!(e instanceof NodeList)&&!(e instanceof Node)&&!(e.el instanceof Node)}function te(e){return!!e.forEach}function h(e,t,o,r){return e.addEventListener(t,o,r),()=>e.removeEventListener(t,o,r)}function g(e){return c("div",{innerHTML:e}).firstChild}function c(e,...t){let o=e.split("."),r=o[0],n=o.slice(1),i=r==="svg"?document.createElementNS("http://www.w3.org/2000/svg","svg"):document.createElement(r||"div");r==="svg"&&i.setAttribute("xmlns","http://www.w3.org/2000/svg");let d=t[0],l=ee(d)&&d;return n.length&&(i.className=n.join(" ")),oe(l,i),ne(l?t.slice(1):t,i),i}function oe(e,t){return t&&e&&Object.keys(e).forEach(o=>{let r=e[o];if(o==="class"||o==="className"){let n=r&&r.split(" ");n&&n.length&&t.classList.add(...n)}else o==="innerHTML"||o==="textContent"||typeof r=="function"||o.startsWith("$")?t[o]=r:r!==!1&&r!==void 0&&r!==null&&t.setAttribute(o,r)}),t}function ne(e,t){return t.appendChild(A(e)),t}function A(e,t){return t||(t=document.createDocumentFragment()),e instanceof Node||typeof e=="string"?re(e,t):(te(e)&&Array.from(e).forEach(o=>o&&A(o,t)),t)}function re(e,t){if(!e)return t;let o=typeof e=="string"?document.createTextNode(e):e;return t instanceof Range?(t.insertNode(o),t.collapse()):t instanceof Node&&t.appendChild(o),t}var y=()=>g('<svg fill="currentColor" viewBox="0 0 24 24"><path d="M5 4h-3v-1h3v1zm10.93 0l.812 1.219c.743 1.115 1.987 1.781 3.328 1.781h1.93v13h-20v-13h3.93c1.341 0 2.585-.666 3.328-1.781l.812-1.219h5.86zm1.07-2h-8l-1.406 2.109c-.371.557-.995.891-1.664.891h-5.93v17h24v-17h-3.93c-.669 0-1.293-.334-1.664-.891l-1.406-2.109zm-11 8c0-.552-.447-1-1-1s-1 .448-1 1 .447 1 1 1 1-.448 1-1zm7 0c1.654 0 3 1.346 3 3s-1.346 3-3 3-3-1.346-3-3 1.346-3 3-3zm0-2c-2.761 0-5 2.239-5 5s2.239 5 5 5 5-2.239 5-5-2.239-5-5-5z" /></svg>'),C=()=>g('<svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>'),x=()=>g('<svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" /></svg>');(function(){if(window.ImageCapture)return;let t=document.createElement("script");t.src="https://unpkg.com/image-capture@0.4.0/lib/imagecapture.min.js",document.head.appendChild(t)})();function I(e){let t=!!window.MediaRecorder;return{filepicker:!0,takephoto:e.includes("takephoto")&&!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia),takevideo:e.includes("takevideo")&&t,takeaudio:e.includes("takeaudio")&&t}}function U(e){let o=(e.video?["video/mp4","video/mpeg","video/webm"]:["audio/mpeg","audio/webm","audio/ogg","audio/wav","audio/mp3","audio/mp4"]).filter(r=>MediaRecorder.isTypeSupported(r))[0];if(!o)throw new Error("No supported mime type found.");return o}function z(e){return e.name=`your${e.type.replace("/",".")}`,e}function O(e){let t=[],o,r;function n(u){u.data.size>0?t.push(u.data):console.error("No data",u)}function i(){return o}function d(){let u=o.getVideoTracks()[0];return new ImageCapture(u).takePhoto().then(z)}function l(){t=[],r=new MediaRecorder(o,{mimeType:U(e)}),r.ondataavailable=n,r.start()}function p(){return new Promise((u,s)=>{r.onstop=()=>{e.isDisposed()&&s(new Error("Disposed."));try{let a=new Blob(t,{type:U(e)});u(z(a))}catch(a){s(a)}},r.stop()})}return setTimeout(function u(){if(e.isDisposed()){r&&r.state!=="inactive"&&r.stop();return}setTimeout(u,1e3)},1e3),navigator.mediaDevices.getUserMedia(e).then(u=>(o=u,{liveSrc:i,capturePhoto:d,beginMediaCapture:l,endMediaCapture:p}))}function S(){let e=navigator.userAgent.toLowerCase();return e.includes("safari/")&&/ip(ad|hone|od)/.test(e)}function M(e){let t=e.onPickFiles,o=e.accept,r=e.sources,n=e.beginCaptureMedia,i=I(r),d=S(),l=(s,a,f)=>i[s]&&c("button.quik-footer-btn.quik-main-footer-btn",{onclick(m){m.preventDefault(),n(s)}},a(),f),p=()=>{let s=i.takevideo,a=i.takephoto,f=s?"video/*;capture=camcorder":a?"image/*,":"";if(!!f)return c("label.quik-footer-btn.quik-main-footer-btn",C(),s?"Take photo or video":"Take photo",c("input.quik-file-input",{type:"file",accept:f,onchange(m){t(m.target.files)}}))},u=c("label.quik-drop-target.quik-content",{ondragover(s){s.preventDefault(),u.classList.add("quik-drop-target-active")},ondragleave(){u.classList.remove("quik-drop-target-active")},ondrop(s){s.preventDefault(),s.stopPropagation();let a=s.dataTransfer.files;!e.multiple&&a.length>1&&(a=[a[0]]),t(a)}},c("input.quik-file-input",{type:"file",accept:o,multiple:e.multiple,onchange(s){t(s.target.files)}}),g('<svg class="quik-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" /></svg>'),c("h2.quik-header","Upload a file"),c(".quik-instructions",c("span.quik-text","Drag or paste a file here, or choose an option below."),c("footer.quik-footer",c("span.quik-footer-btn.quik-footer-btn-primary",g('<svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>'),"Choose File"),!d&&l("takephoto",y,"Take Photo"),!d&&l("takevideo",C,"Record Video"),d&&p(),l("takeaudio",x,"Record Audio"))));return u}function F(e){let t=e.close;return c(".quikpik",{onmousedown:t,ontouchstart:t},c("div.quik-body",{onmousedown(r){r.stopPropagation()},ontouchstart(r){r.stopPropagation()}},M(e)))}function b(e,t){e.querySelector(".quik-body").firstChild.replaceWith(t)}function N(){return c(".quik-progress",c("span.quik-progress-text",c("span.quik-filename","Uploading..."),c("span.quik-percent","0%")),c("span.quik-progress-bar-wrapper",c("span.quik-progress-bar",{style:"width: 0%"})))}function W(e,t,o){let r=e.querySelector(".quik-progress-bar");e.querySelector(".quik-filename").textContent=`Uploading ${o}`,e.querySelector(".quik-percent").textContent=Math.round(t)+"%",r.style.width=t+"%",t>=100&&r.classList.add("quik-done-bar")}function X(e,t,o,r){let n=0,i=!1,d=new Image;function l(){let u=o.width;o.width=o.height,o.height=u}function p(u,s,a){if(!s||!i)return;let f=s.getContext("2d");f.translate(s.width/2,s.height/2),f.rotate(a*Math.PI/180),f.drawImage(u,-u.width/2,-u.height/2),f.rotate(-a*Math.PI/180),f.translate(-s.width/2,-s.height/2)}return d.addEventListener("load",()=>{i=!0,o.width=d.width,o.height=d.height,p(d,o,n),r()}),d.addEventListener("error",()=>alert("Failed to load image.")),d.src=e,{save(u="image/png",s=void 0){return n?new Promise(a=>o.toBlob(f=>{f.name=t&&t.name,a(f)},u,s)):Promise.resolve(t)},rotate(){n=(n+90)%360,l(),p(d,o,n)}}}var R=32,T=32;function ie(e){let t=e.image,o=e.cropBounds,r=e.scale,n=c("canvas");return n.width=o.width*r,n.height=o.height*r,n.getContext("2d").drawImage(t,o.left*r,o.top*r,o.width*r,o.height*r,0,0,n.width,n.height),new Promise(d=>{n.toBlob(l=>{l.name=t.name,d(l)},"image/png")})}function ae(e){let t=e.parentElement,o=c(".quik-crop");return t.appendChild(o),o}function L(e){let t=e.changedTouches&&e.changedTouches[0];return t&&(e.clientX=t.clientX,e.clientY=t.clientY),e}function Y(e,t){e=L(e);let o=t.getBoundingClientRect(),r=Math.max(10,Math.floor(o.width/5)),n=Math.max(10,Math.floor(o.height/5)),i=e.clientX<o.left+n,d=e.clientX>o.right-r,l=e.clientY<o.top+n,p=e.clientY>o.bottom-n;return(l?"n":p?"s":"")+(d?"e":i?"w":"")||"move"}function ce(e){let t=e.bounds,o=e.parentBounds,r=Math.max(o.top,t.top+e.deltaY),n=Math.max(o.left,t.left+e.deltaX);return r+t.height>o.bottom&&(r=o.bottom-t.height),n+t.width>o.right&&(n=o.right-t.width),{top:r,left:n}}function se(e){let t=e.bounds,o=e.parentBounds,r=Math.min(o.right,t.left+t.width+e.deltaX),n=Math.max(T,r-t.left);if(!e.aspectRatio)return{width:n};let i=n*e.aspectRatio;return t.top+i>o.bottom&&(i=o.bottom-t.top,n=i/e.aspectRatio),{width:n,height:i}}function ue(e){let t=e.bounds,o=e.parentBounds,r=Math.min(o.bottom,t.top+t.height+e.deltaY),n=Math.max(R,r-t.top);if(!e.aspectRatio)return{height:n};let i=n/e.aspectRatio;return t.left+i>o.right&&(i=o.right-t.left,n=i*e.aspectRatio),{width:i,height:n}}function P(e){let t=e.bounds,o=e.parentBounds,r=Math.max(o.left,t.left+e.deltaX),n=t.right-r;if(n<T&&(r-=T-n,n=T),!e.aspectRatio)return{left:r,width:n};let i=n*e.aspectRatio;return t.top+i>o.bottom&&(i=o.bottom-t.top,n=i/e.aspectRatio,r=t.right-n),t.bottom-i<o.top&&(i=t.bottom-o.top,n=i/e.aspectRatio,r=t.right-n),{left:r,width:n,height:i}}function de(e){let t=e.bounds,o=e.parentBounds,r=Math.max(o.top,t.top+e.deltaY),n=t.bottom-r;if(n<R&&(r-=R-n,n=R),!e.aspectRatio)return{top:r,height:n};let i=n/e.aspectRatio;return t.left+i>o.right&&(i=o.right-t.left,n=i*e.aspectRatio,r=t.bottom-n),{width:i,height:n,top:r}}function le(e){let t={};return e.direction==="sw"&&e.aspectRatio?P(e):e.direction==="nw"&&e.aspectRatio?(t=P(e,"n"),t.top=e.bounds.bottom-t.height,t):(e.direction.includes("s")&&(Object.assign(t,ue(e)),e.aspectRatio)||e.direction.includes("n")&&(Object.assign(t,de(e)),e.aspectRatio)||(e.direction.includes("w")&&Object.assign(t,P(e)),e.direction.includes("e")&&Object.assign(t,se(e))),t)}function $(e){return{left:e.offsetLeft,top:e.offsetTop,height:e.offsetHeight,width:e.offsetWidth,bottom:e.offsetTop+e.offsetHeight,right:e.offsetLeft+e.offsetWidth}}function fe(e,t,o,r,n){let i=$(t),d=e.clientX,l=e.clientY,p={direction:n,aspectRatio:o,parentBounds:i,bounds:$(r),deltaY:0,deltaX:0,applyEvent(u){u=L(u),p.deltaX=u.clientX-d,p.deltaY=u.clientY-l},resize(u){Object.keys(u).forEach(s=>{r.style[s]=Math.round(u[s])+"px"})}};return p}function B(e,t){let o=ae(e),r=!1;h(o,"mousedown",n),h(o,"touchstart",n),h(o,"mousemove",i=>{if(!i.buttons){let d=Y(i,o);o.style.cursor=d==="move"?"grabbing":d+"-resize"}});function n(i){if(i.preventDefault(),i=L(i),r)return;r=!0;let d=Y(i,o),l=fe(i,e,t,o,d),p=[];function u(a){l.applyEvent(a),l.resize(d==="move"?ce(l):le(l))}function s(){r=!1,p.forEach(a=>a())}p=[h(document,"mousemove",u),h(document,"touchmove",u),h(document,"mouseup",s),h(document,"touchend",s),h(document,"touchcancel",s)]}return{el:o,dispose(){o.remove()},apply(i){return ie({image:i,cropBounds:{top:o.offsetTop-e.offsetTop,left:o.offsetLeft-e.offsetLeft,width:o.offsetWidth,height:o.offsetHeight},scale:i.naturalWidth/e.offsetWidth})}}}function pe(e,t){let o=new Image;return new Promise(r=>{o.onload=()=>{r(t(o)),URL.revokeObjectURL(o.src)},o.src=URL.createObjectURL(e)})}function H(e){let t=e.url,o=e.file,r=e.cancelText,n=e.confirmText,i=e.onCancel,d=e.onConfirm,l=e.requireCrop,p=e.cropRatio,u,s=c(".quik-content-wrapper",c(".quik-text","Loading...")),a=c("canvas.quik-confirm-item"),f=c(".quik-content",a),m=X(t,o,a,()=>{u=l?B(a,p):void 0,s.appendChild(c("footer.quik-footer",c("button.quik-footer-btn",{onclick:i},r),!l&&c("button.quik-footer-btn",{onclick(){u?(u.dispose(),u=void 0):u=B(a,p)}},g('<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M24 18h-4v-14h-14v-4h-2v4h-4v2h4v14h14v4h2v-4h4v-2zm-18 0v-12h12v12h-12z"/></svg>'),"Crop"),c("button.quik-footer-btn",{onclick:m.rotate},g('<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c3.31 0 6.291 1.353 8.459 3.522l2.48-2.48 1.061 7.341-7.437-.966 2.489-2.489c-1.808-1.807-4.299-2.928-7.052-2.928-5.514 0-10 4.486-10 10s4.486 10 10 10c3.872 0 7.229-2.216 8.89-5.443l1.717 1.046c-2.012 3.803-6.005 6.397-10.607 6.397-6.627 0-12-5.373-12-12s5.373-12 12-12z" /></svg>')," Rotate"),c("button.quik-footer-btn.quik-footer-btn-primary",{onclick(k){k.target.disabled=!0,m.save().then(v=>u?pe(v,u.apply):v).then(v=>{v.name||(v.name=o.name),d(v)})}},n))),s.firstChild.replaceWith(f)});return s}function V(e){let t=e.url,o=e.file,r=e.cancelText,n=e.confirmText,i=e.onCancel,d=e.onConfirm,l=o.type.startsWith("video/")?c("video.quik-vid.quik-content",{src:t,controls:!0}):c("audio",{src:t,controls:!0});return c(".quik-content-wrapper",c(".quik-confirm-item",l),c("footer.quik-footer",c("button.quik-footer-btn",{onclick:i},r),c("button.quik-footer-btn.quik-footer-btn-primary",{onclick(p){p.target.disabled=!0,d(o)}},n)))}var me=10;function he(e){let t=c("video.quik-vid.quik-content");return t.srcObject=e.recorder.liveSrc(),t.muted=!0,t.controls=!1,t.play(),t}function ge(e,t,o){let r=Date.now(),n=t*60,i=s=>`${Math.floor(s/60)}:${`00${s%60}`.slice(-2)} / ${t}:00`,d,l=c("span.quik-progress-bar",{style:"width: 0%"}),p=c("span.quik-duration",i(0)),u=c(".quik-progress",c("span.quik-progress-text",c("span.quik-filename",e),p),c("span.quik-progress-bar-wrapper",l));return d=setTimeout(function s(){let a=Math.floor((Date.now()-r)/1e3);if(p.textContent=i(a),l.style.width=`${Math.floor(a*100/n)}%`,a>=n){o();return}u.isConnected&&setTimeout(s,1e3)},1e3),u}function G(e){let t=e.onPickFiles,o=e.maxDuration||me,r=e.onCancel,n=e.type,i,d=c("p.quik-info.quik-content",`Waiting for your ${n==="takeaudio"?"microphone":"camera"}...`),l=c("footer.quik-footer",c("button.quik-footer-btn.quik-footer-btn-secondary",{onclick:r},"Cancel")),p=c(".quik-media",d,l),u=()=>!p.isConnected,s=a=>d.replaceWith(c("p.quik-error",a.toString()));return O({video:n!=="takeaudio",audio:n!=="takephoto",isDisposed:u}).then(a=>{let f=()=>{d.textContent="Generating preview...",i&&i.remove(),(n==="takephoto"?a.capturePhoto():a.endMediaCapture()).then(k=>t([k])).catch(s)};d.textContent=n==="takephoto"?"":`Ready to record. You can record up to ${o} minutes of ${n==="takeaudio"?"audio":"video"}.`,n!=="takeaudio"&&p.insertBefore(he({recorder:a,onPickFiles:t,onError:s}),d),l.appendChild(c("button.quik-footer-btn.quik-footer-btn-primary",{onclick(m){n==="takephoto"||i?(m.target.disabled=!0,f()):(a.beginMediaCapture(),i=ge("Recording...",o,f),d.textContent="",p.insertBefore(i,l),m.target.innerHTML="",m.target.append(x(),c("span","Stop recording")))}},n==="takephoto"?y():n==="takeaudio"?x():C(),n==="takephoto"?"Take Photo":"Begin Recording"))}).catch(s),p}function ke(e){e=w({sources:["filepicker","takephoto"]},e);let t,o=E(),r=[h(window,"keydown",a=>{(a.key==="Escape"||a.code==="Escape")&&d()}),h(document.body,"paste",a=>{a.clipboardData&&a.clipboardData.files&&a.clipboardData.files.length&&(a.preventDefault(),l(a.clipboardData.files))})],n=q(w({},e),{close:d,uploadFiles:s,onPickFiles:l,beginCaptureMedia:u,promise:o,root:void 0,uploader:void 0});n.root=F(n);function i(){b(n.root,M({onPickFiles:l,beginCaptureMedia:u,accept:n.accept,sources:n.sources}))}function d(){o.resolve(t),n.root.remove(),r.forEach(a=>a()),n.uploader&&(n.uploader.cancel(),n.uploader=void 0)}function l(a){let f=a.length===1?a[0]:void 0;if(f&&f.type!=="image/gif"&&!f.type.startsWith("image/svg")&&f.type.startsWith("image/")){let m=URL.createObjectURL(f);r.push(()=>URL.revokeObjectURL(m)),b(n.root,H(q(w({},e),{url:m,file:f,cancelText:"Cancel",confirmText:"Accept & upload",onCancel:i,onConfirm:k=>s([k])})));return}s(a)}function p(a){let f=a[0],m=URL.createObjectURL(f);r.push(()=>URL.revokeObjectURL(m)),b(n.root,V(q(w({},e),{url:m,file:f,cancelText:"Cancel",confirmText:"Accept & upload",onCancel:i,onConfirm:k=>s([k])})))}function u(a){b(n.root,G({type:a,onPickFiles:a==="takephoto"?l:p,onCancel:i,maxDuration:n.maxDuration}))}function s(a){if(e.customProgress)n.root.remove(),n.uploader=e.upload({files:a,onProgress(){}}),n.uploader.promise.then(f=>o.resolve(f)).catch(o.reject);else{let f=N();b(n.root,f),n.uploader=e.upload({files:a,onProgress(m,k){W(f,m,k)}}),n.uploader.promise.then(m=>{t=m,setTimeout(d,250)}).catch(o.reject)}return n.uploader}return o.cancel=d,n}function ve(e={}){let t=ke(e);return document.body.appendChild(t.root),t.promise}export{ve as default};
